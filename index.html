<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¤å…´ä¹‹è·¯ Â· å®Œæ•´ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f1c40f;
        }
        body {
            font-family: 'å¾®è½¯é›…é»‘', sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .era-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        .active-era {
            display: block;
        }
        .city-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
        }
        .crisis-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .crisis-item {
            padding: 12px;
            background: #fff9e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
        }
        .decision-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .decision-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .decision-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .resource-bar {
            height: 20px;
            background: #eee;
            border-radius: 10px;
            margin: 10px 0;
        }
        .resource-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s;
        }
        .timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #final-result {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="timer" id="timer">å‰©ä½™æ—¶é—´: <span id="timeLeft">30</span>ç§’</div>
    <h1 style="color: var(--primary-color); text-align: center;">å¤å…´ä¹‹è·¯</h1>

    <!-- ç¬¬ä¸€çºªå…ƒ 1949 -->
    <div id="era1949" class="era-section active-era">
        <div class="city-card">
            <h2>1949å¹´ Â· å¤å…´åŸ</h2>
            <div class="crisis-list">
                <div class="crisis-item">
                    <span>ğŸ’¸</span>1è¢‹ç±³=100æ†é’ç¥¨
                </div>
                <div class="crisis-item">
                    <span>ğŸ‘¥</span>å•†äººå›¤è´§æŠ¬ä»·
                </div>
                <div class="crisis-item">
                    <span>ğŸŒ¾</span>ç²®ä»“å³å°†è§åº•
                </div>
                <div class="crisis-item">
                    <span>ğŸŒ</span>å¤–å›½å…¨é¢å°é”
                </div>
            </div>
            <div class="resource-bar">
                <div id="resourceBar1949" class="resource-fill" style="width:100%;background:var(--primary-color)"></div>
            </div>
        </div>
        <div class="decision-container" id="decisions1949"></div>
    </div>

    <!-- ç¬¬äºŒçºªå…ƒ 2025 -->
    <div id="era2025" class="era-section">
        <div class="city-card">
            <h2 id="currentStatusTitle">2025å¹´ Â· å¤å…´åŸ</h2>
            <div class="crisis-list" id="statusBadges"></div>
            <div class="resource-bar">
                <div id="resourceBar2025" class="resource-fill" style="width:100%;background:var(--primary-color)"></div>
            </div>
        </div>
        <div class="decision-container" id="decisions2025"></div>
    </div>

    <div id="final-result"></div>

    <script>
        // æ¸¸æˆé…ç½®
        const decisionConfig = {
            1949: {
                options: [
                    {
                        key: 'A',
                        title: 'è‡ªå·±å½“å®¶ä½œä¸»',
                        color: 'var(--success-color)',
                        items: ['æŠ“æ•æŠ•æœºå¥¸å•†', 'å¼€è®¾å›½è¥ç²®åº—', 'å‘åŠ¨ç¾¤ä¼—å®£ä¼ ']
                    },
                    {
                        key: 'B',
                        title: 'æ‰¾è€å¤§å“¥å¸®å¿™',
                        color: 'var(--warning-color)',
                        items: ['ä½¿ç”¨å¤–å›½è´§å¸', 'ç§»äº¤æµ·å…³ç®¡ç†æƒ', 'ç…§æ¬è®¡åˆ’ç»æµ']
                    },
                    {
                        key: 'C',
                        title: 'æ‰“å¼€å›½é—¨æ±‚æ´',
                        color: 'var(--danger-color)',
                        items: ['å…è®¸å¤–å¸æµé€š', 'å¼•è¿›å¤–å›½èµ„æœ¬', 'å–æ¶ˆç²®é£Ÿç®¡åˆ¶']
                    }
                ]
            },
            2025: {
                options: [
                    {
                        key: 'A',
                        title: 'å…¨æ°‘é€ èŠ¯è¿åŠ¨',
                        color: 'var(--success-color)',
                        items: ['é«˜æ ¡æ‰©æ‹›ç†å·¥ç”Ÿ', '24å°æ—¶ç ”å‘æ”»å…³', 'å›½äº§æ›¿ä»£æ–¹æ¡ˆ']
                    },
                    {
                        key: 'B',
                        title: 'ç­¾åŸä¸‹ä¹‹ç›Ÿ',
                        color: 'var(--warning-color)',
                        items: ['äº¤å‡ºæŠ€æœ¯æ•°æ®', 'åœæ­¢è‡ªä¸»ç ”å‘', 'è´­ä¹°é«˜ä»·èŠ¯ç‰‡']
                    },
                    {
                        key: 'C',
                        title: 'æ‰¾æ–°æœ‹å‹å¸®å¿™',
                        color: 'var(--danger-color)',
                        items: ['èµ„æºç½®æ¢æŠ€æœ¯', 'å»ºç«‹åéœ¸è”ç›Ÿ', 'ç»•å¼€ç¾å…ƒç»“ç®—']
                    }
                ]
            }
        };

        // æ¸¸æˆæ ¸å¿ƒé€»è¾‘
        let gameState = {
            currentEra: 1949,
            path: [],
            resources: 100,
            timeLeft: 30,
            status: {
                tech: 70,
                autonomy: 80,
                foreignControl: 20,
                stability: 60
            }
        };

        const eraEffects = {
            '1949A': { tech: 15, autonomy: 20, foreignControl: -15, resourceCost: 30 },
            '1949B': { tech: -20, autonomy: -40, foreignControl: 50, resourceCost: 20 },
            '1949C': { tech: -40, autonomy: -60, foreignControl: 80, resourceCost: 15 },
            '2025A': { tech: 30, autonomy: 25, foreignControl: -20, resourceCost: 40 },
            '2025B': { tech: -25, autonomy: -40, foreignControl: 35, resourceCost: 25 },
            '2025C': { tech: 15, autonomy: 10, foreignControl: 15, resourceCost: 35 }
        };

        let timerId;

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            generateDecisions(1949);
            generateDecisions(2025);
            startTimer();
        }

        // ç”Ÿæˆéšæœºé€‰é¡¹
        function generateDecisions(year) {
            const container = document.getElementById(`decisions${year}`);
            const options = [...decisionConfig[year].options];
            
            // éšæœºæ’åºé€‰é¡¹
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }

            container.innerHTML = options.map(opt => `
                <div class="decision-card" 
                     style="border-color: ${opt.color}"
                     onclick="handleChoice(${year}, '${opt.key}')">
                    <h3 style="color: ${opt.color}">ğŸ® ${opt.title}</h3>
                    <ul>${opt.items.map(item => `<li>${item}</li>`).join('')}</ul>
                </div>
            `).join('');
        }

        // å¤„ç†å†³ç­–é€‰æ‹©
        function handleChoice(year, choice) {
            if(gameState.resources <= 0) return;
            
            const effectKey = `${year}${choice}`;
            if(!eraEffects[effectKey]) return;
            
            applyEffects(effectKey);
            gameState.path.push(choice);

            if(checkResourceLimit()) return;
            
            if(year === 1949) {
                if(Math.random() < 0.4) triggerRandomEvent();
                switchEra(2025);
                startTimer();
            } else {
                showFinalResult();
            }
        }

        // åº”ç”¨å†³ç­–æ•ˆæœ
        function applyEffects(key) {
            const effects = eraEffects[key];
            Object.keys(effects).forEach(k => {
                if(k !== 'resourceCost') {
                    gameState.status[k] = clamp(gameState.status[k] + effects[k]);
                }
            });
            gameState.resources = clamp(gameState.resources - effects.resourceCost);
            updateResourceDisplay();
            updateStatusDisplay();
        }

        // åˆ‡æ¢çºªå…ƒ
        function switchEra(newEra) {
            document.querySelectorAll('.era-section').forEach(era => {
                era.classList.remove('active-era');
            });
            document.getElementById(`era${newEra}`).classList.add('active-era');
            gameState.currentEra = newEra;
            generateDecisions(newEra);
        }

        // æ›´æ–°èµ„æºæ˜¾ç¤º
        function updateResourceDisplay() {
            const barId = `resourceBar${gameState.currentEra}`;
            const barElement = document.getElementById(barId);
            if(barElement) {
                barElement.style.width = gameState.resources + '%';
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            const statusMap = {
                'A': ['ğŸ”‹ ç§‘æŠ€çªç ´', 'ğŸ‘©ğŸ”§ äººæ‰å‚¨å¤‡', 'ğŸ›¡ï¸ æŠ—å‹èƒ½åŠ›', 'ğŸŒ æŠ€æœ¯å°é”'],
                'B': ['ğŸ”Œ æŠ€æœ¯ä¾èµ–', 'ğŸ’¸ å¤–æ±‡å±æœº', 'ğŸ¤ ç›Ÿå‹å…³ç³»', 'âš ï¸ æ•°æ®é£é™©'],
                'C': ['ğŸ—ï¸ å¤–èµ„æ§åˆ¶', 'ğŸ“‰ äº§ä¸šç©ºå¿ƒ', 'ğŸŒªï¸ ç¤¾ä¼šåŠ¨è¡', 'ğŸ’¼ ä¹°åŠå½“æƒ']
            };
            
            const badges = statusMap[gameState.path[0]]?.map((text, i) => `
                <div class="crisis-item">
                    <span>${text}</span>
                    <progress value="${Object.values(gameState.status)[i]}" max="100"></progress>
                </div>
            `).join('');

            document.getElementById('statusBadges').innerHTML = badges;
        }

        // è§¦å‘éšæœºäº‹ä»¶
        function triggerRandomEvent() {
            const events = [
                { msg: "ğŸŒ§ï¸ è‡ªç„¶ç¾å®³ï¼èµ„æºå‡å°‘15%", effect: () => gameState.resources -= 15 },
                { msg: "ğŸ’¸ è´§å¸å±æœºï¼å¤–èµ„æ§åˆ¶å¢åŠ 20%", effect: () => gameState.status.foreignControl += 20 }
            ];
            const event = events[Math.floor(Math.random() * events.length)];
            event.effect();
            alert(event.msg);
            updateResourceDisplay();
        }

        // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
        function showFinalResult() {
            const resultText = getFinalOutcome();
            document.getElementById('final-result').innerHTML = `
                <div class="city-card">
                    <h3>ğŸ æœ€ç»ˆç»“å±€ï¼ˆ2049å¹´ï¼‰</h3>
                    <p style="font-size:1.2em;color:var(--primary-color)">${resultText}</p>
                    <div class="crisis-list">
                        <div class="crisis-item">ç§‘æŠ€åŠ›ï¼š${gameState.status.tech}%</div>
                        <div class="crisis-item">è‡ªä¸»æƒï¼š${gameState.status.autonomy}%</div>
                        <div class="crisis-item">å¤–èµ„ç‡ï¼š${gameState.status.foreignControl}%</div>
                        <div class="crisis-item">ç¨³å®šåº¦ï¼š${gameState.status.stability}%</div>
                    </div>
                    <button onclick="location.reload()" style="margin-top:20px;padding:10px 20px;">
                        å†è¯•ä¸€æ¬¡ ğŸ”„
                    </button>
                </div>
            `;
        }

        // è¾…åŠ©å‡½æ•°
        function clamp(value) {
            return Math.max(0, Math.min(100, value));
        }

        function checkResourceLimit() {
            if(gameState.resources <= 0) {
                showFinalResult("âš ï¸ èµ„æºè€—å°½ï¼åŸå¸‚å‘å±•é™·å…¥åœæ»");
                return true;
            }
            return false;
        }

        function startTimer() {
            clearInterval(timerId);
            gameState.timeLeft = 30;
            document.getElementById('timeLeft').textContent = gameState.timeLeft;
            
            timerId = setInterval(() => {
                gameState.timeLeft--;
                document.getElementById('timeLeft').textContent = gameState.timeLeft;
                
                if(gameState.timeLeft <= 0) {
                    autoDecision();
                    clearInterval(timerId);
                }
            }, 1000);
        }

        function autoDecision() {
            const choices = document.querySelectorAll(`#decisions${gameState.currentEra} .decision-card`);
            if(choices.length > 0) {
                const randomIndex = Math.floor(Math.random() * choices.length);
                choices[randomIndex].click();
            }
        }

        function getFinalOutcome() {
            const path = gameState.path.join('');
            const outcomes = {
                'AA': 'ğŸš€ ç§‘æŠ€å¼ºå›½å´›èµ·',
                'AB': 'âš–ï¸ è‡ªä¸»ä¸ä¾èµ–çš„å¹³è¡¡',
                'AC': 'ğŸŒ æ–°å…´å¸‚åœºé¢†å¯¼è€…',
                'BA': 'ğŸ’¥ è½¬å‹å¤±è´¥å±æœº',
                'BB': 'âš« å½»åº•æ®–æ°‘åŒ–',
                'BC': 'ğŸŒªï¸ åŒé‡åˆ¶è£å›°å¢ƒ',
                'CA': 'âš”ï¸ ä¸»æƒäº‰å¤ºæˆ˜',
                'CB': 'ğŸ’¸ èµ„æœ¬æ¸¸ä¹åœº',
                'CC': 'ğŸ•³ï¸ èµ„æºé»‘æ´'
            };
            return outcomes[path] || 'ğŸŒŒ æœªçŸ¥çš„å‘å±•é“è·¯...';
        }

        // å¯åŠ¨æ¸¸æˆ
        window.onload = initGame;
    </script>
</body>
</html>
